$(function(){function a(){d.on("click","#v_chk_promiss",function(){$(this).is(":checked")?$(".version-btn-sureInvest").attr("disabled",!1).removeClass("disabled"):$(".version-btn-sureInvest").attr("disabled",!0).addClass("disabled")}),d.on("click",".version-btn-closePopup,.version-popup-closed a",function(){return 1!=j.baseInfo.url&&2!=j.baseInfo.url||0!=d.find("input.disabled").length||5==j.mycalculate.popupStatus||E(),h.hidePopup(),$(this).trigger("successClick").unbind("successClick"),!1}),$(document).on("click",function(a){(1==j.baseInfo.url||5==j.baseInfo.url)&&$(".version-popup-start .version-popup-recive").not(":hidden").trigger("click",[!0]),3==j.baseInfo.url&&$(".version-popup-rate").not(":hidden").trigger("click",[!0])}),$(document).on("keyup",function(a){if(13==a.keyCode){if(1==d.not(":hidden").length){var b=$(".version-btn-sureInvest"),c=$(".version-btn-closePopup");1==b.not(":hidden").length?b.trigger("click"):0==$("input[data-cdtime='1']").length&&c.not(":hidden").length&&c.trigger("click")}else if(1==j.baseInfo.url){var e=$(document.activeElement);e.hasClass("ver-input-money")&&e.parent().find(".ver-btn").trigger("click")}else if(5==j.baseInfo.url){var e=$(document.activeElement).parent();e.hasClass("version-project-input-box")&&$(".v-detail-btnInvest").trigger("click")}else if(6==j.baseInfo.url){var e=$(document.activeElement).parent();e.hasClass("version-project-input-box")&&$("input[data-type='btn-finance']").trigger("click")}}else 27==a.keyCode&&1==d.not(":hidden").length&&$(".version-btn-closePopup").trigger("click")});var a=window.navigator.userAgent;if(-1!=a.indexOf("MSIE 6.0")||-1!=a.indexOf("MSIE 7.0")||-1!=a.indexOf("MSIE 8.0")||-1!=a.indexOf("MSIE 9.0"));else{var b=document.createElement("style");b.innerHTML="\r\n		        .version-popup-closed a em{\r\n		        	-webkit-transition: all 0.3s linear;\r\n			        -ms-transition: all 0.3s linear;\r\n			        -moz-transition: all 0.3s linear; \r\n			        transition: all 0.3s linear; \r\n		        }\r\n		        .version-popup-closed a:hover em{\r\n		        	-webkit-transform: rotate(90deg);\r\n		            -moz-transform: rotate(90deg);\r\n		            -ms-transform: rotate(90deg);\r\n		            transform: rotate(90deg);\r\n		        }",document.getElementsByTagName("head")[0].appendChild(b)}}function b(a){var b=i.isIE8();setTimeout(function(){var c=a?a.find(".cvs-circle-progress"):$(".cvs-circle-progress");c.each(function(a,c){b&&G_vmlCanvasManager.initElement(c),i.setCanvas(c,$(c).next().find(".span-circle-progress"))})},50)}if(-1!=window.location.pathname.toLowerCase().indexOf("/invest/9"))return!1;var c=$(".main-offsetHeight"),d=$(".version-popup-main:not([data-type])"),e=$(".version1-mask"),f=$(".version-popup:not([data-type])"),g=$(".online"),h={showPopup:function(){var a=$(window).width(),b=$(window).height(),g=$(document).width(),h=$(document).height(),j=(a-f.width())/2,k=(b-f.height())/2;d.show(),e.show().css("width",g+"px").css("height",h+"px"),f.show().css("top",k+$(window).scrollTop()+"px").css("left",j+"px"),c.addClass("back-blur"),i.loadTemplate(),$(".version-popup-mask").height(d.height()+16)},hidePopup:function(){if("object"==typeof GLOBAL_COUNTDOWN){var a=GLOBAL_COUNTDOWN;for(var b in a)"isCorrect"!=b&&(a[b]=!1)}d.hide(),e.hide(),f.hide(),c.removeClass("back-blur"),i.reBtn()},showTranFailBusy:function(){j.mycalculate.popupStatus=0,j.serverObj.errorCode=4,j.mycalculate.errorId=11,h.showPopup()},showTranFailSold:function(){j.mycalculate.popupStatus=0,j.serverObj.errorCode=4,j.mycalculate.errorId=22,h.showPopup()},showMoneyError:function(){j.mycalculate.popupStatus=0,j.serverObj.errorCode=4,j.mycalculate.errorId=6,h.showPopup()},showBidRevoke:function(){j.mycalculate.popupStatus=0,j.serverObj.errorCode=4,j.mycalculate.errorId=5,h.showPopup()},showNoLogin:function(){j.baseInfo.typeName="快速登录",j.mycalculate.popupStatus=0,j.serverObj.errorCode=4,j.mycalculate.errorId=4,h.showPopup()},showSystemBusy:function(){j.mycalculate.popupStatus=0,j.serverObj.errorCode=4,j.mycalculate.errorId=3,h.showPopup()},showInvestFull:function(){j.mycalculate.popupStatus=0,j.serverObj.errorCode=4,j.mycalculate.errorId=2,h.showPopup()},showCannotInvestOwner:function(){j.mycalculate.popupStatus=0,j.serverObj.errorCode=4,j.mycalculate.errorId=1,h.showPopup()},showBalanceLess:function(){j.mycalculate.popupStatus=0,j.serverObj.errorCode=1,h.showPopup()},showBidBalanceLess:function(){j.mycalculate.popupStatus=0,j.serverObj.errorCode=2,h.showPopup()},showNewConditionError:function(){j.mycalculate.popupStatus=0,j.serverObj.errorCode=3,j.mycalculate.errorId=1,h.showPopup()},showSecConditionError:function(){j.mycalculate.popupStatus=0,j.serverObj.errorCode=3,j.mycalculate.errorId=2,h.showPopup()},showSuccess:function(){j.mycalculate.popupStatus=0,j.serverObj.errorCode=0,h.showPopup(),(5==j.baseInfo.url||6==j.baseInfo.url)&&$(".version-btn-closePopup,.version-popup-closed a").on("successClick",function(){window.location.reload()})},showRevokeSuccess:function(){j.mycalculate.popupStatus=0,j.serverObj.errorCode=6,h.showPopup()}},i={disBtn:function(){$(this).attr("disabled",!0).addClass("ver-stop-btn").addClass("disabled")},reBtn:function(){$(".ver-stop-btn").each(function(a,b){$(b).attr("disabled",!1).removeClass("ver-stop-btn").removeClass("disabled")})},loadTemplate:function(){var a=template("src_popup/popup_content",j);d.html(a)},loadHongbaoTemplate:function(){var a=template("src_popup/show_Hongbao_detail",j);$(".version-popup-start .version-popup-ul[data-popup-type='hongbao']").html(a)},getUsedMoney:function(a,b){var c=a;return b&&(c-=b),$("#v_usedMoney").html(i.fmtMoney(c)),c},fmtMoney:function(a,b,c){return 0!==b&&(b=2|b),"number"!=typeof parseInt(a)||c||(a=(a/100).toFixed(b)),a=(""+a).replace(/(\d)(?=(?:\d{3})+(?:\.\d+)?$)/g,"$1,")},getIsCheckedCouponList:function(a){if(a){j.mycalculate.chooseCouponUserId=0;for(var b=[],c=!1,d=0;d<a.length;d++){var e=new Date(a[d].expiredTime);a[d].expiredDate=i.addZero(e.getFullYear())+"-"+i.addZero(e.getMonth()+1)+"-"+i.addZero(e.getDate()),a[d].minBidAmount<=j.mycalculate.investMoney?(a[d].isChecked=!0,c=!0):a[d].isChecked=!1,b.push(a[d])}return a.length>0&&(c?j.serverObj.data.hasCoupon=1:j.serverObj.data.hasCoupon=2),1==j.serverObj.data.hasCoupon?j.mycalculate.auto_checked="":j.mycalculate.auto_checked="checked=checked",b}},addZero:function(a){return 10>a?"0"+a:a},addCurrentBalanceByMaxCoupon:function(a,b,c,d,e){if(e&&0!=e.length){for(var f=[],g=0;g<e.length;g++){var h=e[g].minBidAmount,i=e[g].minBidAmount-e[g].amount;a>=h&&b>=h&&c>=h&&d>=i&&f.push(e[g])}if(0!=f.length){for(var k=0,g=0;g<f.length;g++){var l=f[g];k<l.amount&&(k=l.amount)}j.serverObj.data.currentBalance+=k}}},setConfigByCompare:function(a,b,c,d){j.mycalculate.reminder=null;var e=i.getMinByCompare(a,b,c,d);switch(e.min=100*Math.floor(e.min/100),e.result){case 1:j.mycalculate.reminder=3,j.mycalculate.investMoney=e.min;break;case 2:j.mycalculate.investMoney=e.min;break;case 3:j.mycalculate.reminder=2,j.mycalculate.investMoney=e.min;break;case 4:j.mycalculate.reminder=1,j.mycalculate.investMoney=e.min}j.mycalculate.usedAmount=j.mycalculate.investMoney},getMinByCompare:function(a,b,c,d){var e=b,f=2;return e>a&&(e=a,f=1),e>d&&(e=d,f=4),e>c&&(e=c,f=3),{result:f,min:e}},resultConfig:{35:h.showMoneyError,"-3":h.showSystemBusy,"-4":h.showSystemBusy,"-5":h.showCannotInvestOwner,51:h.showCannotInvestOwner,38:h.showNewConditionError,15:h.showBalanceLess,31:h.showInvestFull,34:h.showInvestFull,36:h.showInvestFull,52:h.showInvestFull,32:h.showBidBalanceLess,33:h.showBidBalanceLess,37:h.showSecConditionError,99:h.showSystemBusy},resetMoney:function(a){return(""+a).replace(/,/g,"")},isIE8:function(){return!$.support.changeBubbles},sortToHongbao:function(a,b,c,d,e){if(d=d||"down",b>c)return[];if(b==c)return[a[b]];if(b==c-1)return"down"==d?a[b][e]>a[c][e]?[a[c],a[b]]:[a[b],a[c]]:a[b][e]<a[c][e]?[a[c],a[b]]:[a[b],a[c]];for(var f=Math.floor((b+c)/2),g=i.sortToHongbao(a,b,f,d,e),h=i.sortToHongbao(a,f+1,c,d,e),j=[];g.length>0||h.length>0;){if(0==g.length){j=j.concat(h);break}if(0==h.length){j=j.concat(g);break}"down"==d?g[0][e]>h[0][e]?j.push(h.shift()):j.push(g.shift()):g[0][e]<h[0][e]?j.push(h.shift()):j.push(g.shift())}return j},setCanvas:function(a,b){if(a.getContext){var c=a.getContext("2d"),d={zero:"#e7e6e6",small:"#ffd200",midium:"#ff510d",big:"#81c931"},e=[],f=38,g=40,h=4,i=24;"1"==$(a).attr("progress-detail")&&(f=g=26,i=22),"true"==$(a).attr("data-dqb")&&(g=50),c.clearRect(0,0,$(a).width(),$(a).height());var j=1*a.getAttribute("data-precent");""==b.html()&&b.html(j);var k=0==j?"zero":j>0&&50>j?"small":j>=50&&100>j?"midium":"big";e.push({color:d[k],circle:j}),e.push({color:"#ececec",circle:100-j});for(var l=!$.support.changeBubbles,m=0,n=0;n<e.length&&270!=m;n++){var o=e[n].circle/100*360,p=0==n?-90:m,q=m=p+o;270==q&&l&&(q=-90),c.beginPath(),c.arc(f,g,i,p/180*Math.PI,q/180*Math.PI),c.strokeStyle=e[n].color,c.lineWidth=h,c.stroke(),c.closePath()}}},fmtTime:function(a){var b=new Date(1*a);return b.getFullYear()+"-"+i.addZero(b.getMonth()+1)+"-"+i.addZero(b.getDate())}};a();var j={baseInfo:{url:1},mycalculate:{},serverObj:{data:{}},codes:{repayMode:codes.repayMode,local_tooltip:codes.local_tooltip,globalRules:codes.globalRules}},k=window.location.pathname.toLowerCase();switch(k){case"/invest":case"/invest/":case"/invest/0":case"/invest/2":j.baseInfo.url=1,j.baseInfo.bidOperType=0,j.baseInfo.btnName="确认投资";break;case"/invest/1":j.baseInfo.url=2,j.baseInfo.bidOperType=1,j.baseInfo.btnName="确认投资";break;case"/myaccount/invest/list":j.baseInfo.url=3,j.baseInfo.bidOperType=1,j.baseInfo.btnName="确定转让";break;case"/myaccount/transfer/list":j.baseInfo.url=4,j.baseInfo.bidOperType=1,j.baseInfo.btnName="确定撤销"}if(-1!=k.indexOf("/bid/detail/")?(j.baseInfo.url=5,j.baseInfo.bidOperType="1"==globalConfig.isTransfer?1:0,j.baseInfo.btnName="确认投资",j.baseInfo.bid=k.substring(k.lastIndexOf("/")+1),j.baseInfo.typeName=$.trim($(".version-basic-title strong:eq(0)").html()),j.mycalculate.notUseCoupon=!1,"1"==globalConfig.isForFresh&&(j.mycalculate.notUseCoupon=!0),"1"==globalConfig.isSeckill&&(j.mycalculate.notUseCoupon=!0),globalConfig.hasMortgage>0?j.mycalculate.isMortgage=!0:j.mycalculate.isMortgage=!1):-1!=k.indexOf("/fb/detail/")&&(j.baseInfo.url=6,j.baseInfo.bidOperType=0,j.baseInfo.typeName=$.trim($(".version-basic-title").attr("data-text")),j.baseInfo.btnName="确认投资",j.baseInfo.bid=k.substring(k.lastIndexOf("/")+1),j.mycalculate.notUseCoupon=!0),j.mycalculate.registerUrl=j.mycalculate.loginUrl="https://passport.souyidai.com/?backurl="+location.href,window.setCvsProgress=b,b(),1==j.baseInfo.url||2==j.baseInfo.url||5==j.baseInfo.url||6==j.baseInfo.url){var l=function(a){$.ajax({url:"/export/invest/userData",type:"Get",async:a.async,dataType:"json",data:{t:Math.random()}}).done(function(b){if(0==b.errorCode){var c=i.fmtMoney(b.data.couponAmount,2);1==j.baseInfo.url||2==j.baseInfo.url?($(".version-red-envelope").show(),$("strong[data-class='v-pp-balance']").html(i.fmtMoney(b.data.currentBalance,2)),$("strong[data-class='v-pp-coupon']").html(c)):(5==j.baseInfo.url||6==j.baseInfo.url)&&$("a[data-detail-hb=1]").html(c),a.succFn&&a.succFn(b)}})},m=function(a){l({async:a.async,succFn:function(a){j.serverObj=a,j.mycalculate.popupStatus=1,j.mycalculate.auto_disabled="",j.mycalculate.chooseCouponUserId=0,j.serverObj.data.couponList.length>0?(j.serverObj.data.hasCoupon=1,j.serverObj.data.couponList=i.sortToHongbao(j.serverObj.data.couponList,0,j.serverObj.data.couponList.length-1,"down","minBidAmount")):j.serverObj.data.hasCoupon=0;for(var b=0;b<j.serverObj.data.raiseInterestCouponList.length;b++){var c=j.serverObj.data.raiseInterestCouponList[b];c.expiredTime=i.fmtTime(c.expiredTime)}}})};void 0==$.cookie("syd_name")?$(".version-red-envelope").hide():($(".version-red-envelope").show(),m({async:!0}));var n=function(a){i.disBtn.call($(".version-btn-sureInvest")),$.ajax({url:"/bid/dobid",type:"POST",dataType:"JSON",data:a.data}).done(function(a){if(j.serverObj.errorCode=a.errorCode,1==a.errorCode)return"noLogin"==a.errorMessage?void h.showNoLogin():void h.showSystemBusy();if(0===a.errorCode){var b=a.data.retCode,c=a.data.realAmount;j.mycalculate.usedAmount=a.data.realAmount,0===b?(0==j.baseInfo.bidOperType&&j.mycalculate.investMoney>c&&(j.mycalculate.result_reminder=!0),j.mycalculate.investMoney=a.data.realAmount,j.mycalculate.usedAmount=j.mycalculate.investMoney-a.data.couponAmount,j.serverObj.data.couponAmount=a.data.couponAmount,h.showSuccess(),m&&m({async:!0})):i.resultConfig[b]?i.resultConfig[b]():h.showSystemBusy()}else h.showSystemBusy()}).fail(function(){h.showSystemBusy()}).always(function(){i.reBtn()})},o=function(a){$.ajax({url:"/invest/bidData",type:"POST",dataType:"json",data:{bidIds:a.bidIds,isTransfer:a.isTransfer}}).done(function(b){a.succFn&&a.succFn(b)}).fail(function(){})},p=function(a){$.ajax({url:"/fb/listData",type:"POST",dataType:"json",data:{fbIds:a.fbIds}}).done(function(b){a.succFn&&a.succFn(b)}).fail(function(){})}}if(3==j.baseInfo.url||4==j.baseInfo.url)var q=function(){$.ajax({url:"/myaccount/transfer/interest/"+j.baseInfo.bid+"/"+j.baseInfo.cancleType+"?t="+Math.random(),type:"Get",dataType:"json"}).done(function(a){if(!a.data)return void h.showSystemBusy();j.serverObj=a,j.mycalculate.changeMoney=Math.abs(j.serverObj.data.actualPrincipal-j.serverObj.data.principal),j.serverObj.data.actualPrincipal+=j.serverObj.data.interest,j.mycalculate.returnMoney=j.serverObj.data.actualPrincipal-j.serverObj.data.transferFee;var b=j.serverObj.data.discountRate;j.mycalculate.transfer_type=1e4==b?0:1e4>b?1:2;var c=(new Date(j.serverObj.data.expireTime),j.serverObj.data.expireTime-(new Date).getTime());diffSecs=c/1e3;var d=Math.floor(diffSecs%60);d=10>d?"0"+d:d;var e=Math.floor(diffSecs/60%60);e=10>e?"0"+e:e;var f=Math.floor(diffSecs/3600%24),g=Math.floor(diffSecs/3600/24);f+=24*g,f=10>f?"0"+f:f,j.mycalculate.expireHours=f,j.mycalculate.expireMinutes=e,j.mycalculate.expireSeconds=d,h.showPopup()}).fail(function(){h.showTranFailBusy()}).always(function(){})},r=function(a){$.ajax({url:"/myaccount/invest/cancle/"+j.baseInfo.bid+"/"+j.baseInfo.cancleType,type:"get",data:{t:Math.random()},dataType:"json",success:function(b){1==b.result?(h.showRevokeSuccess(),a.succFn&&a.succFn()):h.showTranFailBusy()},error:function(){h.showTranFailBusy()}})};if(1==j.baseInfo.url||5==j.baseInfo.url){d.on("click",".version-popup-start[data-popup-type='hongbao'] .version-popup-expiredTime",function(){return s.call(this,"expiredTime"),!1}),d.on("click",".version-popup-start[data-popup-type='hongbao'] .version-popup-minBidAmount",function(){return s.call(this,"minBidAmount"),!1}),d.on("click",".version-popup-start[data-popup-type='hongbao'] .version-popup-amount",function(){return s.call(this,"amount"),!1});var s=function(a){var b=$(this).find(".certifi-img"),c=b.hasClass("icon-down")?"down":"up";$(".version-popup-an .version-popup-updown").removeClass("current").find("em").removeClass("icon-down").removeClass("icon-up"),"down"==c?b.removeClass("icon-down").addClass("icon-up").closest(".version-popup-updown").addClass("current"):b.removeClass("icon-up").addClass("icon-down").closest(".version-popup-updown").addClass("current"),j.serverObj.data.couponList=i.sortToHongbao(j.serverObj.data.couponList,0,j.serverObj.data.couponList.length-1,c,a),i.loadHongbaoTemplate()},a=function(){d.on("click",".version-popup-start .version-popup-recive",function(a,b){var c=$(this).find("i");if(0==c.length)return!1;var d=$(this).closest(".version-popup-start"),e=d.attr("data-popup-type");c.hasClass("an")||b?(c.removeClass("an"),d.find(".version-popup-an").hide()):(c.addClass("an"),d.find(".version-popup-an").show());for(var f=["hongbao","jiaxi"],g=0;g<f.length;g++)if(f[g]!=e){var h=$('.version-popup-start[data-popup-type="'+f[g]+'"]'),i=h.find(".version-popup-recive").find("i");if(!i.hasClass("an"))continue;i.removeClass("an"),h.find(".version-popup-an").hide()}return!1}),d.on("click",".version-popup-ul[data-popup-type='hongbao'] p",function(a,b){var c=$(this);if(!c.children(":first").is("a"))return!1;var d=100*$.trim(c.find("strong:eq(0)").html()),e=$("#auto_1");if(0==d){var f="自动匹配";e.attr({disabled:!1}).closest("span").removeClass("version-popup-checkbox-invalid")}else{var f=i.fmtMoney(d,2)+"元";e.prop("checked",!1).attr({disabled:!0}).closest("span").addClass("version-popup-checkbox-invalid")}var g=c.closest(".version-popup-start").find(".version-popup-recive");g.find("strong:eq(0)").html(f),j.mycalculate.chooseCouponUserId=c.attr("data-hbid"),i.getUsedMoney(j.mycalculate.investMoney,d),c.parent().find("p>a").each(function(a,b){var c=$(this);c.removeClass("active")}),c.find("a").addClass("active"),c.closest(".version-popup-start").find(".version-popup-recive").trigger("click",[!0])}),d.on("click",".version-popup-ul[data-popup-type='jiaxi'] p",function(){var a=$(this);if(!a.children(":first").is("a"))return!1;var b=$.trim(a.find("strong:eq(0)").html());if(""==b)var c="请选择加息券";else var c="加息"+b;var d=a.closest(".version-popup-start").find(".version-popup-recive");d.find("strong:eq(0)").html(c).attr("data-id",a.attr("data-jxid")),a.parent().find("p>a").each(function(a,b){var c=$(this);c.removeClass("active")}),a.find("a").addClass("active"),a.closest(".version-popup-start").find(".version-popup-recive").trigger("click",[!0])})};a();var t=function(){var a=j.serverObj.data.couponList.length;4>a&&($hbUl=$(".version-popup-ul[data-popup-type=hongbao]"),$hbUl.css("height",33*$hbUl.children().length+"px"))},u=function(){var a=j.serverObj.data.raiseInterestCouponList.length;4>a&&($itUl=$(".version-popup-ul[data-popup-type=jiaxi]"),$itUl.css("height",33*$itUl.children().length+"px"))},v=function(){var a={bidId:j.baseInfo.bid,bidAmount:j.mycalculate.investMoney,isFullAmountBuy:!$("#auto_1").is(":checked"),authCode:"",couponUserId:j.mycalculate.chooseCouponUserId,isUseCoupon:1==j.serverObj.data.hasCoupon?0==j.mycalculate.chooseCouponUserId?1:2:1};if(j.mycalculate.showInterest){var b=$(".version-popup-start[data-popup-type='jiaxi']").find(".version-popup-recive strong:eq(0)").attr("data-id");-1!=b&&0==j.mycalculate.useInterest&&(a.raiseInterestCouponId=b)}n({data:a})}}if(2==j.baseInfo.url||5==j.baseInfo.url){d.on("click","em[check-type='popup-transfer-checked']",function(){var a=$(this),b=$(".vertransfer-one-confoot").find("em[check-type='popup-transfer-checked']");a.hasClass("checked")?a.removeClass("checked"):a.addClass("checked"),b.eq(1).hasClass("checked")?$(".version-btn-sureInvest").attr("disabled",!1).removeClass("disabled"):$(".version-btn-sureInvest").attr("disabled",!0).addClass("disabled")});var w=!0;d.on("click",".vertransfer-one-table .vertransfer-one-title p span",function(){var a=$(this);if(!a.hasClass("current")&&!a.hasClass("disabled")){var b=a.parent(),c=$(".vertransfer-one-list").children(),d=a.index(".vertransfer-one-title p span");b.children("span").removeClass("current"),a.addClass("current"),0==d?(c.eq(0).show(),c.eq(1).hide(),$("#popup-vertransfer-actualPrice").html(i.fmtMoney(j.serverObj.data.amount,2))):1==d&&(c.eq(0).hide(),c.eq(1).show(),y.call($("#btn-vertransfer-partmoney")))}}).on("mouseenter",".vertransfer-one-table .vertransfer-one-title p span",function(){var a=$(this);a.hasClass("disabled")||a.addClass("hover")}).on("mouseleave",".vertransfer-one-table .vertransfer-one-title p span",function(){var a=$(this);a.hasClass("disabled")||a.removeClass("hover")}),d.on("focus","#btn-vertransfer-partmoney",function(){$this=$(this),$this.parent().addClass("focus"),w&&($this.val(""),w=!1)}).on("blur","#btn-vertransfer-partmoney",function(){$this=$(this),$this.parent().removeClass("focus")});var x=null,y=function(){clearTimeout(x);var a=$(this),b=/[^\d]/g,c=a.val(),d=$("#span-buy-part-tips"),e=j.baseInfo.planInvestMoney;return d.not(":hidden").length&&Math.round(100*c)>e?void $(this).val(c.substring(0,a.val().length-1)):(d.hide(),!w&&b.test(c)&&(a.val(c.replace(b,"")),c=a.val()),Math.round(100*c)>e?d.css("display","inline-block").find('span[span-type="buy-span-tips"]').html("投资金额不能大于转让金额"):(d.hide(),""==c&&(c=0),x=setTimeout(function(){A({succFn:z,principal:Math.round(100*c)})},300)),void 0)},z=function(a){var b=a.data.bidTransfer.status;if(2==b)return void h.showInvestFull();if(3==b||4==b)return void h.showBidRevoke();var c=($("#btn-vertransfer-partmoney"),$("#popup-vertransfer-changeMoney")),d=$("#popup-vertransfer-jiexi"),e=$("#popup-vertransfer-actualPrice");c.html(i.fmtMoney(Math.abs(a.data.principalDiscount),2)),d.html(i.fmtMoney(a.data.interest,2)),e.html(i.fmtMoney(a.data.amount,2))},A=function(a){$.ajax({url:"/transfer/biddetail",type:"POST",dataType:"JSON",data:{bidId:j.baseInfo.bid,principal:a.principal||j.baseInfo.planInvestMoney},error:function(){h.showSystemBusy()}}).done(function(b){return 1==b.errorCode?void("noLogin"==b.errorMessage?h.showNoLogin():h.showSystemBusy()):"object"!=$.type(b.data)?void h.showSystemBusy():void(a.succFn&&a.succFn(b))}).fail(function(){h.showSystemBusy()}).always(function(){i.reBtn()})},B=function(a){j.serverObj=a;var b=j.serverObj.data.bidTransfer.status;if(2==b)return void h.showInvestFull();if(3==b||4==b)return void h.showBidRevoke();j.mycalculate.popupStatus=2;var c=j.serverObj.data.principalDiscount;j.mycalculate.transfer_type=0>c?1:c>0?3:2,j.serverObj.data.bid={repayMode:j.serverObj.data.bidTransfer.repayMode,isFixedRepay:j.serverObj.data.bidTransfer.isFixedRepay},w=!0,h.showPopup(),$("#btn-vertransfer-partmoney").off("input propertychange").on("input propertychange",function(){y.call(this)})},C=function(){var a=$("#btn-vertransfer-partmoney"),b=$("#span-buy-part-tips"),c=1==a.not(":hidden").length?100*a.val():j.baseInfo.planInvestMoney;if(a.not(":hidden").length){if(b.not(":hidden").length)return;if(a.val()<100)return void b.css("display","inline-block").find('span[span-type="buy-span-tips"]').html("投资金额不能小于100元")}D({data:{bidId:j.baseInfo.bid,principal:c,isFullAmountBuy:!$(".vertransfer-one-confoot").find("em[check-type='popup-transfer-checked']:eq(0)").hasClass("checked")}})},D=function(a){i.disBtn.call($(".version-btn-sureInvest")),$.ajax({url:"/transfer/dobid",type:"POST",dataType:"JSON",data:a.data}).done(function(a){if(j.serverObj.errorCode=a.errorCode,1==a.errorCode)return"noLogin"==a.errorMessage?void h.showNoLogin():void h.showSystemBusy();if(0===a.errorCode){var b=a.data.retCode,c=a.data.realAmount;j.mycalculate.usedAmount=a.data.realAmount,0===b?(0==j.baseInfo.bidOperType&&j.mycalculate.investMoney>c&&(j.mycalculate.result_reminder=!0),j.mycalculate.investMoney=a.data.realPrincipal,j.mycalculate.usedAmount=a.data.realAmount,j.serverObj.data.couponAmount=0,h.showSuccess(),m&&m({async:!0})):i.resultConfig[b]?i.resultConfig[b]():h.showSystemBusy()}else h.showSystemBusy()}).fail(function(){h.showSystemBusy()}).always(function(){i.reBtn()})}}if(1==j.baseInfo.url){g.on("keyup",".ver-input-money",function(){var a=$(this),b=/[^\d]/g,c=a.val();b.test(c)&&a.val(c.replace(b,""))}),g.on("click",".ver-invest-btns .ver-btn",function(){var a=$(this),b=a.parent().find(".ver-input-money"),c=parseInt(b.val());if(isNaN(c)||0==c)return void b.val("").focus();if(void 0===$.cookie("syd_name"))return void h.showNoLogin();j.serverObj||m({async:!1});var d=a.closest(".version-item");if(j.mycalculate.notUseCoupon=!1,j.baseInfo.typeName=$.trim(d.find(".ver-top a").text()),j.serverObj.data.currentBalance=parseInt(100*$.trim($("strong[data-class='v-pp-balance']").html().replace(/,/g,""))),j.serverObj.data.currentBalance<100)return void h.showBalanceLess();var e=d.find("strong[data-text='loan_seckill']:visible").length,f=d.find(".version-second:eq(0)").attr("hasAddRate");if(e>0||"true"==f)j.mycalculate.showInterest=!1,j.mycalculate.useInterest=0;else{var g=a.attr("data-raise");0==g?(j.mycalculate.showInterest=!0,j.mycalculate.useInterest=0):g>0?(j.mycalculate.showInterest=!0,j.mycalculate.useInterest=g/100):void 0==g&&(j.mycalculate.showInterest=!1)}i.disBtn.call(a),j.mycalculate.popupStatus=1,j.serverObj.data.bid={},j.baseInfo.bid=a.attr("data-bidid"),j.baseInfo.planInvestMoney=100*c;var k=d.find(".version-infor .version-infor-list");j.serverObj.data.bid.lilv=$.trim(k.filter(":eq(0)").find(".version-second .version-num").text()),j.serverObj.data.bid.qixian=$.trim(k.filter(":eq(3)").find(".version-second").text());var l=k.filter(":eq(4)").find(".version-second");if(j.serverObj.data.bid.fangshi=$.trim(l.find(".version-text").text()),j.baseInfo.planInvestMoney<=0)return void h.showMoneyError();var n=0,o=1*$.trim(k.filter(":eq(1)").find(".version-second .version-num").text().replace(/,/g,""));if($table=a.parent().parent().find(".ver-invest-money tbody tr:eq(0) td:eq(0)"),n=100*parseInt($table.find("span:eq(0)").attr("data-canbidamount").replace(/,/g,"")),j.mycalculate.surplusMoney=d.attr("data-remainingamounts"),"2"==d.attr("data-ialres-type")?j.mycalculate.projectLimitMoney=100*Math.floor(o*(d.attr("data-ialres-val")/100)/100):"1"==d.attr("data-ialres-type")&&(j.mycalculate.projectLimitMoney=d.attr("data-ialres-val")),"1"==d.attr("data-isforfresh")&&(j.mycalculate.showInterest=!1,j.mycalculate.notUseCoupon=!0),"1"==d.attr("data-isseckill")&&(j.mycalculate.showInterest=!1,j.mycalculate.notUseCoupon=!0),d.attr("data-hasMortgage")>0?j.mycalculate.isMortgage=!0:j.mycalculate.isMortgage=!1,j.serverObj.data.bid.curUserBiddingAmount=$.trim($table.find("span:eq(1)").attr("data-biddingamount")),isNaN(n)&&(n=0),0>=n)return void h.showBidBalanceLess();if(i.addCurrentBalanceByMaxCoupon(j.mycalculate.surplusMoney,j.baseInfo.planInvestMoney,n,j.serverObj.data.currentBalance,j.serverObj.data.couponList),i.setConfigByCompare(j.mycalculate.surplusMoney,j.baseInfo.planInvestMoney,n,j.serverObj.data.currentBalance),j.serverObj.data.couponList=i.getIsCheckedCouponList(j.serverObj.data.couponList),a.attr("data-opentime")){j.mycalculate.isPre=!0;var p=a.attr("data-bidtime").split(/-|:|\s/),q=new Date(p[0],p[1]-1,p[2],p[3],p[4],p[5]),r=q.getTime();"object"!=typeof GLOBAL_COUNTDOWN||GLOBAL_COUNTDOWN[r]||(GLOBAL_COUNTDOWN[r]=!0)}else j.mycalculate.isPre=!1;h.showPopup(),"object"==typeof GLOBAL_COUNTDOWN&&(GLOBAL_COUNTDOWN.input=$("input[data-cdtime='1']")),t(),u()}),g.on("click",".ver-invest-btns input[data-mobile='1']",function(){j.mycalculate.popupStatus=5,j.baseInfo.typeName="手机专享投资",h.showPopup()}),d.on("click",".version-btn-sureInvest",v);var E=function(){var a="",b=[];$(".ver-invest-btns input").each(function(c,d){var e=$(this),f=e.attr("data-bidid");f&&(a+=f+",",b[f]=e.parents(".version-item-w279"))}),o({bidIds:a,isTransfer:0,succFn:function(a){$.each(a.data,function(a,c){if(11==c.status||12==c.status){var d=b[a],e=d.closest(".version-item");if(11==c.status){var f="1"==e.attr("data-ialres-type")?"bid_avail_yuan":"bid_avail_percent",g=d.find(".ver-invest-money span:eq(0) strong a").attr("data-param"),h=d.find(".ver-invest-btns .ver-btn");void 0!=h.attr("data-raise")&&h.attr("data-raise",c.curUserRaiseInterest),0!=c.curUserRaiseInterest&&0==e.find(".inrlabel").length&&e.find(".version-second:eq(0)").append('<span class="inrlabel"><span>+'+c.curUserRaiseInterest/100+'%</span><span class="ar_up"></span></span>'),d.find(".ver-invest-money span:eq(0)").html('<strong class="">可投金额(元)<a href="javascript:;" data-text="'+f+'" data-param="'+g+'" class="version-ico version-tooltip-css tooltipcol"></a></strong>'+i.fmtMoney(c.canBidAmount,2));var j=c.biddingPercent/100;j=99>j&&j>0?Math.ceil(j):j>=100?100:Math.floor(j);var k=d.find(".cvs-circle-progress").attr("data-precent",j),l=k.next().find(".span-circle-progress");return l.html(j),i.setCanvas(k[0],l),d.find(".ver-invest-money span:eq(1)").length||0===c.curUserBiddingAmount?d.find(".ver-invest-money span:eq(1)").html('<span><strong class="">已投金额(元)<a href="####" data-text="bid_inv_already" class="version-ico version-tooltip-css tooltipcol"></a></strong>'+i.fmtMoney(c.curUserBiddingAmount,2)+"</span>"):d.find(".ver-invest-money td").append('<span><strong class="">已投金额(元)<a href="####" data-text="bid_inv_already" class="version-ico version-tooltip-css tooltipcol"></a></strong>'+i.fmtMoney(c.curUserBiddingAmount,2)+"</span>"),d.parent().attr("data-remainingamounts",c.remainingAmounts),d.find(".ver-invest-money tbody tr:eq(0) td:eq(0)").find("span:eq(1)").attr("data-biddingamount",c.curUserBiddingAmount/100),void d.find(".ver-invest-money tbody span:eq(0)").attr("data-canbidamount",c.canBidAmount/100)}if(12==c.status){var m="满标审核中";0===c.curUserBiddingAmount?d.html('<div class="ver-cls-w77 relative"><canvas class="cvs-circle-progress" data-precent="100" width="77" height="80"></canvas><div class="verxon-mask-progress"><span data-type="cerxon-span" class="span-circle-progress">100</span>%</div></div><div class="ver-cls-w190"><table border="0" cellspacing="0" cellpadding="0" class="ver-push-box"><tbody><tr><td><span class="ver-push-status">'+m+"</span></td></tr></tbody></table></div>"):(0!=c.curUserRaiseInterest&&0==e.find(".inrlabel").length&&e.find(".version-second:eq(0)").append('<span class="inrlabel"><span>+'+c.curUserRaiseInterest/100+'%</span><span class="ar_up"></span></span>'),d.html('<div class="ver-cls-w77 relative"><canvas class="cvs-circle-progress" data-precent="100" width="77" height="80"></canvas><div class="verxon-mask-progress"><span data-type="cerxon-span" class="span-circle-progress">100</span>%</div></div><div class="ver-cls-w190"><table border="0" cellspacing="0" cellpadding="0" class="ver-push-box"><tbody><tr><td><span class="ver-push-money"><strong>已投金额(元)</strong><a href="####" data-text="您在本投资项目累计投资金额" class="version-ico version-tooltip-css tooltipcol"></a>'+i.fmtMoney(c.curUserBiddingAmount,2)+'</span><span class="ver-push-status">'+m+"</span></td></tr></tbody></table></div>"));var k=d.find(".cvs-circle-progress"),l=k.next().find(".span-circle-progress");i.isIE8()&&G_vmlCanvasManager.initElement(k[0]),i.setCanvas(k[0],l)}}})}});var c="",d=[];$(".version-limited-btns input").each(function(a,b){var e=$(this),f=e.attr("fbId-data");f&&(c+=","+f,d[f]=e.parents(".version-limited-proportion"))}),p({fbIds:c.substring(1),succFn:function(a){for(var b in a.data){var c=a.data[b],e=d[b];if(e){var f=c.biddingPercent/100;f=99>=f?Math.ceil(f):Math.floor(f);var g=e.find(".cvs-circle-progress").attr("data-precent",f),h=g.next().find(".span-circle-progress");if(h.html(f),i.setCanvas(g[0],h),100==f){var j=e.closest(".version-invest-limited");j.addClass("version-invest-full-scale"),j.find(".version-limited-icon").remove(),e.find(".version-limited-w190").remove();var k="";c.curUserBiddingAmount&&(k='<strong>已投金额(元)</strong><a href="javascript:;" data-text="bid_inv_already" class="version-ico version-tooltip-css tooltipcol"></a><em>'+i.fmtMoney(c.curUserBiddingAmount)+"</em>");var l='<div class="version-limited-state">\r\n	                                <table border="0" cellspacing="0" cellpadding="0" class="version-limited-talbe">\r\n	                                    <tbody>\r\n	                                    <tr>\r\n	                                        <td>\r\n	                                            <span class="version-limited-push-money">'+k+'</span>\r\n	                                            <span class="version-limited-push-status">收益累计中</span>\r\n	                                        </td>\r\n	                                    </tr>\r\n	                                    </tbody>\r\n	                                </table>\r\n	                            </div>';e.append(l)}}}}})}}if(2==j.baseInfo.url){g.on("click",".vertransfer-action .version-btn-h30",function(){if(void 0===$.cookie("syd_name"))return void h.showNoLogin();j.serverObj||m({async:!1});var a=$(this),b=a.closest(".version-item");b.attr("data-hasMortgage")>0?j.mycalculate.isMortgage=!0:j.mycalculate.isMortgage=!1,j.baseInfo.bid=a.attr("data-bidid"),j.baseInfo.typeName=$.trim(b.find(".ver-top a").text()),j.baseInfo.planInvestMoney=b.find('span[data-type="transfer-benjin"]').attr("remainPrincipal").replace(/,/g,"");var c=j.baseInfo.planInvestMoney<100?j.baseInfo.planInvestMoney:100;
return j.serverObj.data.currentBalance<c?void h.showBalanceLess():(i.disBtn.call(a),void A({succFn:B}))}),d.on("click",".version-btn-sureInvest",C);var E=function(){var a="",b=[];$(".version-item-w279 input").each(function(c,d){var e=$(this),f=e.attr("data-bidid");f&&(a+=f+",",b[f]=e.parents(".version-item-w279"))}),o({bidIds:a,isTransfer:1,succFn:function(a){$.each(a.data,function(a,c){var d="",e=b[a];if(e){switch(c.status){case 1:d="购买转让";break;case 2:d="转让成功";break;case 3:case 4:d="已撤销"}if(1==c.status||2==c.status){var f=e.closest(".version-item"),g="bid_sum_tran",h=e.find(".ver-invest-money span:eq(0) strong a").attr("data-param");e.find(".ver-invest-money span:eq(0)").html('<strong>可投金额(元)<a href="javascript:;" data-text="'+g+'" data-param="'+h+'" class="version-ico version-tooltip-css tooltipcol"></a></strong> '+i.fmtMoney(c.remainAmount,2));var j=c.biddingPercent/100;j=99>j&&j>0?Math.ceil(j):Math.floor(j);var k=e.find(".cvs-circle-progress").attr("data-precent",j),l=k.next().find(".span-circle-progress");l.html(j),i.setCanvas(k[0],l),e.find(".ver-invest-money span:eq(1)").length||0===c.curUserBiddingAmount?e.find(".ver-invest-money span:eq(1)").html('<span><strong class="">已投金额(元)<a href="####" data-text="bid_inv_already_tran" class="version-ico version-tooltip-css tooltipcol"></a></strong> '+i.fmtMoney(c.curUserBiddingAmount,2)+"</span>"):e.find(".ver-invest-money td").append('<span><strong class="">已投金额(元)<a href="####" data-text="bid_inv_already_tran" class="version-ico version-tooltip-css tooltipcol"></a></strong> '+i.fmtMoney(c.curUserBiddingAmount,2)+"</span>"),f.find('span[data-type="transfer-benjin"]').attr("remainPrincipal",c.remainPrincipal)}1!=c.status&&e.find(".vertransfer-action input").addClass("disabled").attr("disabled",!0).val(d).end()}})}})}}if(3==j.baseInfo.url){var F=function(){$.ajax({url:"/myaccount/invest/interest/"+j.baseInfo.bid+"/"+j.serverObj.data.discountRate,type:"get",data:{t:Math.random()},dataType:"json",success:function(a){if(!a.data)return void h.showSystemBusy();j.serverObj=a,j.mycalculate.popupStatus=3,j.mycalculate.changeMoney=Math.abs(j.serverObj.data.actualPrincipal-j.serverObj.data.principal),j.serverObj.data.actualPrincipal+=j.serverObj.data.interest,j.mycalculate.returnMoney=j.serverObj.data.actualPrincipal-j.serverObj.data.transferFee;var b=j.serverObj.data.discountRate;j.mycalculate.transfer_type=1e4==b?0:1e4>b?1:2,h.showPopup(),j.serverObj.data.actualYearRate<j.codes.globalRules.tran_raise_rate_limit&&$(".version-btn-sureInvest").attr("disabled",!0).addClass("disabled")}})},a=function(){d.on("click",".version-popup-item-title>p a",function(){j.serverObj.data.discountRate=$(this).attr("data-defaultBili"),F()}),d.on("click",".version-popup-rate",function(a,b){var c=$(this);return c.find("i").hasClass("an")||b?(c.find("i").removeClass("an"),c.parent().find(".version-popup-rate-list").hide()):(c.find("i").addClass("an"),c.parent().find(".version-popup-rate-list").show()),!1}),d.on("click",".version-popup-rate-list a",function(){var a=$(this);j.serverObj.data.discountRate=100*$.trim(a.text()).replace("%",""),F()})};a(),$(".information").on("click",".btn-transfer",function(){j.mycalculate.popupStatus=3,j.baseInfo.bid=$(this).attr("data-id");var a=$(this).closest(".borrow-list");j.baseInfo.typeName=$.trim(a.find("table tbody td:eq(0) div:eq(0) a").text()),j.serverObj.data.discountRate="10000",j.mycalculate.thisObj=a.find(".modify-table:eq(1) tbody td:eq(0)"),F()}),d.on("click",".version-btn-sureInvest",function(){3==j.mycalculate.popupStatus?G():r({succFn:function(){j.mycalculate.thisObj&&j.mycalculate.thisObj.html('<span style="color: #ff7d5a">已撤销</span>')}})}),$(".information").on("click",".btn-cancle",function(){j.mycalculate.popupStatus=4,j.baseInfo.bid=$(this).attr("data-id"),j.baseInfo.cancleType=1;var a=$(this).closest(".borrow-list");j.baseInfo.typeName=a.find("table tbody td:eq(0) div:eq(0) a").text(),j.mycalculate.thisObj=a.find(".modify-table:eq(1) tbody td:eq(0)"),q()});var G=function(){i.disBtn.call($(".version-btn-sureInvest")),$.ajax({url:"/myaccount/invest/transfer/"+j.baseInfo.bid+"/"+j.serverObj.data.discountRate,type:"get",data:{t:Math.random()},dataType:"json",success:function(a){1==a.result?(h.hidePopup(),j.mycalculate.thisObj&&j.mycalculate.thisObj.html('<div><span class="transfer-in">转让中</span></div><a href="javascript:;" data-id="'+j.baseInfo.bid+'" class="btn-cancle">撤销转让</a>')):h.showSystemBusy()},error:function(){h.showSystemBusy()}})}}if(4==j.baseInfo.url&&($(".information").on("click",".btn-cancle-0",function(){j.mycalculate.popupStatus=4,j.baseInfo.bid=$(this).attr("data-id"),j.baseInfo.cancleType=0;var a=$(this).closest(".borrow-list");j.baseInfo.typeName=a.find("table tbody td:eq(0) div:eq(0) a").text(),j.mycalculate.thisObj=a.find(".modify-table:eq(1) tbody td:eq(0)"),q()}),d.on("click",".version-btn-sureInvest",function(){i.disBtn.call($(".version-btn-sureInvest")),r({succFn:function(){j.mycalculate.thisObj&&(j.mycalculate.thisObj.html('<span class="transfer-cancle">已取消</span>'),j.mycalculate.thisObj.closest(".borrow-list").find("p:eq(4),p:eq(5),p:eq(6)").html("-"))}})})),5==j.baseInfo.url||6==j.baseInfo.url){var H=null,I=1*$.trim($(".version-project-list-item:eq(3) .version-project-text strong").text()).replace(/,/g,""),J=$(".version-project-input-error span"),K=function(a,b){if(!isNaN(parseInt(a))){var c=$(".version-project-subsidiary");if(0==c.not(":hidden").length)return void $(".layout-right").children().eq(0).css("margin-top","0");var d=5==j.baseInfo.url?"/ajax/cal_receipt?bidId="+j.baseInfo.bid+"&amount="+a:"/ajax/cal_product_receipt?productId="+j.baseInfo.bid+"&amount="+a+"&productType="+$(".layout-right").attr("fbType"),e={t:Math.random()},f=$("#hid_bid_rate");if(f){e.investRate=f.val();var g=$(".v-detail-btnInvest[data-raise]");g&&(e.raiseRate=g.attr("data-raise"))}$.ajax({url:d,type:"POST",dataType:"json",data:e}).done(function(c){if(c.data.list){for(var d=0;d<c.data.list.length;d++){var e=c.data.list[d],f=null;5==j.baseInfo.url?(f=new Date(e.periodDate),e.money=e.interest+e.principal+e.subsidyInterest+e.subsidyPrincipal):(f=new Date(e.endDate),e.money=e.interest+e.principal),e.date=i.addZero(f.getFullYear())+"-"+i.addZero(f.getMonth()+1)+"-"+i.addZero(f.getDate())}var g=template("src_detail/profit_detail",c);$(".version-project-reimb-list").empty().html(g);var h=i.fmtMoney(a,2),k=i.fmtMoney(c.data.total-a,2);1==j.baseInfo.bidOperType&&(h=$.trim($(".version-project-price-money strong").html()),k=i.fmtMoney(c.data.total-100*h.replace(/,/g,""),2)),$(".version-project-sub-left .version-project-sub-num").html(h),$(".version-project-sub-right .version-project-sub-num").html(k),b&&b()}}).fail(function(){}).always(function(){})}};$(".version-project-reimb").on("click",".version-project-an-row",function(){$(this).hide().parent().find(".v-invest-listOpen").show()}).on("mouseenter",".version-project-an-row",function(){var a=$(".v-open-profit")[0];AnimationJs.startMove(a,{top:20},{time:180,type:"ease-in",succFn:function(){AnimationJs.startMove(a,{top:8},{time:240,type:"linear",succFn:function(){AnimationJs.startMove(a,{top:12},{time:150,type:"ease-in"})}})}})});var L=function(){clearTimeout(H);var a=$(this),b=/[^\d]/g,c=a.val();if(b.test(c))return void a.val(c.replace(b,""));var d=5==j.baseInfo.url?c:1e3*c;d>I?(a.val(c.substring(0,c.length-1)),d=5==j.baseInfo.url?c:1e3*c,J.html("投资金额不能超过可投金额")):J.html(""),H=setTimeout(function(){var a=$(".version-project-confirm-money span");a.length&&(d=1*d+1*a.html().replace(/,/g,"")),K(100*d)},500)};$(".version-project-input-box input").on("focus",function(){var a=$(this);a.addClass("version-project-arial").parent().addClass("version-project-shadow"),isNaN(parseInt(a.val()))&&a.val("")}).on("input",function(){L.call(this)}).on("propertychange",function(){L.call(this)}).on("blur",function(){var a=$(this);a.parent().removeClass("version-project-shadow"),""==a.val()&&a.val(a.attr("data-text")).removeClass("version-project-arial")});var M=function(){var a=0,b=$(".version-project-confirm-money span");a=b.length?1*b.html().replace(/,/g,""):I>1e4?1e4:I,K(100*a)}}if(5==j.baseInfo.url&&(1==j.baseInfo.bidOperType?(j.baseInfo.planInvestMoney=parseInt($(".version-project-price-money").attr("data")),K(j.baseInfo.planInvestMoney),d.on("click",".version-btn-sureInvest",C)):(M(),d.on("click",".version-btn-sureInvest",v)),$(".version-project-action").on("click",".v-detail-btnInvest",function(){if($input=$(".version-project-input-box input"),j.baseInfo.planInvestMoney=100*$input.val(),isNaN(j.baseInfo.planInvestMoney))return void $input.focus();if(j.mycalculate.popupStatus=1,j.serverObj||m({async:!1}),void 0===$.cookie("syd_name"))return void h.showNoLogin();if(j.serverObj.data.currentBalance=100*globalConfig.currentBalance,j.serverObj.data.currentBalance<100)return void h.showBalanceLess();var a=$(this);i.disBtn.call(a),j.serverObj.data.bid={};var b=$(".version-project-list"),c=b.find(".version-project-list-item"),d=c.filter(":eq(0)").find(".version-project-text strong");j.serverObj.data.bid.lilv=0==d.eq(1).length?$.trim(d.eq(0).text()):$.trim(d.eq(0).text())+"+"+$.trim(d.eq(1).text()),j.serverObj.data.bid.qixian=$.trim(c.filter(":eq(1)").find(".version-project-text").text().replace(/\s+/g,""));c.filter(":eq(4)").find(".version-second");j.serverObj.data.bid.fangshi=$.trim(c.filter(":eq(2)").find(".version-project-text em").text());var e=$.trim(c.filter(":eq(3)").find(".version-project-text strong").text().replace(/,/g,""));if(j.baseInfo.planInvestMoney<=0)return void h.showMoneyError();j.mycalculate.surplusMoney=100*globalConfig.amountBidAval,j.serverObj.data.bid.curUserBiddingAmount=globalConfig.amountAlreadyBid,2==globalConfig.bidBaseLimitAmount.type?j.mycalculate.projectLimitMoney=100*Math.floor(e*(globalConfig.bidBaseLimitAmount.val/100)/100):1==globalConfig.bidBaseLimitAmount.type&&(j.mycalculate.projectLimitMoney=globalConfig.bidBaseLimitAmount.val);var f=j.mycalculate.projectLimitMoney-100*j.serverObj.data.bid.curUserBiddingAmount;if(isNaN(f)&&(f=0),0>=f)return void h.showBidBalanceLess();if(i.addCurrentBalanceByMaxCoupon(j.mycalculate.surplusMoney,j.baseInfo.planInvestMoney,f,j.serverObj.data.currentBalance,j.serverObj.data.couponList),i.setConfigByCompare(j.mycalculate.surplusMoney,j.baseInfo.planInvestMoney,f,j.serverObj.data.currentBalance),j.serverObj.data.couponList=i.getIsCheckedCouponList(j.serverObj.data.couponList),a.attr("data-bidtime")){j.mycalculate.isPre=!0;var g=a.attr("data-bidtime");"object"!=typeof GLOBAL_COUNTDOWN||GLOBAL_COUNTDOWN[g]||(GLOBAL_COUNTDOWN[g]=!0)}else j.mycalculate.isPre=!1;var k=$(".version-basic-title").find("strong[data-text='loan_seckill']:visible").length,l=a.attr("hasAddRate");if(k>0||"true"==l||"1"==globalConfig.isForFresh||"1"==globalConfig.isSeckill)j.mycalculate.showInterest=!1;else{var n=a.attr("data-raise");0==n?(j.mycalculate.showInterest=!0,j.mycalculate.useInterest=0):n>0?(j.mycalculate.showInterest=!0,j.mycalculate.useInterest=n/100):void 0==n&&(j.mycalculate.showInterest=!1)}h.showPopup(),$(".version-project-input-box input").trigger("blur"),"object"==typeof GLOBAL_COUNTDOWN&&(GLOBAL_COUNTDOWN.input=$("input[data-cdtime='1']")),t(),u()}),$(".v-detail-btnTransfer").on("click",function(){if(void 0===$.cookie("syd_name"))return void h.showNoLogin();j.serverObj.data.currentBalance=100*globalConfig.currentBalance,j.baseInfo.planInvestMoney=$.trim($(".version-project-transfer-price .version-project-price-money").attr("data"));var a=j.baseInfo.planInvestMoney<100?j.baseInfo.planInvestMoney:100;if(j.serverObj.data.currentBalance<a)return void h.showBalanceLess();var b=$(this);i.disBtn.call(b),A({succFn:B})})),6==j.baseInfo.url){var N=function(a){i.disBtn.call($(".version-btn-sureInvest")),$.ajax({url:"/fb/dosub",type:"POST",dataType:"JSON",data:a.data}).done(function(a){if(j.serverObj.errorCode=a.errorCode,1==a.errorCode)return"noLogin"==a.errorMessage?void h.showNoLogin():void h.showSystemBusy();if(0===a.errorCode){var b=a.data.retCode;a.data.realAmount;j.mycalculate.usedAmount=a.data.realAmount,0===b?(j.mycalculate.investMoney=a.data.realAmount,j.mycalculate.usedAmount=j.mycalculate.investMoney,j.serverObj.data.couponAmount=0,h.showSuccess(),m&&m({async:!0})):i.resultConfig[b]?i.resultConfig[b]():h.showSystemBusy()}else h.showSystemBusy()}).fail(function(){h.showSystemBusy()}).always(function(){i.reBtn()})},O=function(){N({data:{fbId:j.baseInfo.bid,amount:j.mycalculate.investMoney/100,isFullAmountSub:!0,authCode:""}})};M(),d.on("click",".version-btn-sureInvest",O),$(".version-project-action").on("click","input[data-type='btn-finance']",function(){if($input=$(".version-project-input-box input"),j.baseInfo.planInvestMoney=100*$input.val()*1e3,isNaN(j.baseInfo.planInvestMoney))return void $input.focus();if(j.mycalculate.popupStatus=1,j.serverObj||m({async:!1}),void 0===$.cookie("syd_name"))return void h.showNoLogin();if(j.serverObj.data.currentBalance=100*globalConfig.currentBalance,j.serverObj.data.currentBalance<100)return void h.showBalanceLess();var a=$(this);i.disBtn.call(a),j.serverObj.data.bid={};var b=$(".version-project-list"),c=b.find(".version-project-list-item"),d=c.filter(":eq(0)").find(".version-project-text strong");j.serverObj.data.bid.lilv=0==d.eq(1).length?$.trim(d.eq(0).text()):$.trim(d.eq(0).text())+"+"+$.trim(d.eq(1).text()),j.serverObj.data.bid.qixian=$.trim(c.filter(":eq(1)").find(".version-project-text").text().replace(/\s+/g,""));c.filter(":eq(4)").find(".version-second");j.serverObj.data.bid.fangshi=$.trim(c.filter(":eq(2)").find(".version-project-text em").text());var e=$.trim(c.filter(":eq(3)").find(".version-project-text strong").text().replace(/,/g,""));if(j.baseInfo.planInvestMoney<=0)return void h.showMoneyError();j.mycalculate.surplusMoney=100*globalConfig.amountBidAval,j.serverObj.data.bid.curUserBiddingAmount=globalConfig.amountAlreadyBid,2==globalConfig.bidBaseLimitAmount.type?j.mycalculate.projectLimitMoney=100*Math.floor(e*(globalConfig.bidBaseLimitAmount.val/100)/100):1==globalConfig.bidBaseLimitAmount.type&&(j.mycalculate.projectLimitMoney=globalConfig.bidBaseLimitAmount.val);var f=j.mycalculate.projectLimitMoney-100*j.serverObj.data.bid.curUserBiddingAmount;if(isNaN(f)&&(f=0),0>=f)return void h.showBidBalanceLess();if(j.mycalculate.investMoney=j.mycalculate.usedAmount=j.baseInfo.planInvestMoney,j.serverObj.data.hasCoupon=0,a.attr("data-opentime")){j.mycalculate.isPre=!0;var g=a.attr("data-bidtime").split(/-|:|\s/),k=new Date(g[0],g[1]-1,g[2],g[3],g[4],g[5]),l=k.getTime();"object"!=typeof GLOBAL_COUNTDOWN||GLOBAL_COUNTDOWN[l]||(GLOBAL_COUNTDOWN[l]=!0)}else j.mycalculate.isPre=!1;h.showPopup(),"object"==typeof GLOBAL_COUNTDOWN&&(GLOBAL_COUNTDOWN.input=$("input[data-cdtime='1']"))})}});