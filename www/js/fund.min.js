!function(){function a(){var a=$(this);y.html(a.html()),z.attr("data-value",a.attr("data-value")).removeClass("version-bank-select")}function b(){return{username:$('span[data-type="popup-name"]').html(),id5:$('span[data-type="popup-id5"]').html(),mobile:$("#popup-mobile").val(),bankcarid:$("#popup_id").val(),bankname:$(".version-open-recive").html(),bankcode:$('span[data-type="popup-bank-carid"]').attr("data-value")}}function c(){return $("input[type=text]").not(":hidden").trigger("blur"),A=!0,$(document).trigger("click"),$(".version-popup[data-type='version-popup-mobel']").find(".version-open-item").not(":hidden").hasClass("version-open-border-false")?!1:C.eq(0).hasClass("checked")?C.eq(1).hasClass("checked")?!0:(alert("请阅读并同意服务协议"),!1):(alert("请阅读并同意权益须知"),!1)}function d(){$("div[data-type='version-popup-mobel']").each(function(){var a=$(this),b=a.find("div[data-type='version-popup-main']").height();a.find("div[data-type='version-popup-mask']").height(parseInt(b)+16)})}function e(a){var a=a||{};a.type=a.type||[],a.value=a.value||"",a.maxlen=a.maxlen||0,a.compareVal=a.compareVal||"",a.digit=a.digit||0;var b=new RegExp("^("+(a.digit<=0?"0|":"0|[1-9]\\d{0,"+(a.digit-1)+"}")+")$","g"),c=/^(\d|[1-9]\d|100)$/g,d=/^(\d|[12]\d|30)$/g,e=/^\s+|\s+$/;reg_mobile=/^1[34578][0-9]{9}$/,reg_id=/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X|x)$/,reg_date=/^[12]\d{3}\-\d{2}\-\d{2}$/g,reg_first_phone=/^0(?:[12]\d|\d{3})$/g,reg_second_phone=/^[1-9]\d{6,7}$/g,reg_third_phone=/^\d{1,10}$/g,reg_decimal=new RegExp("^\\d+(\\.\\d{"+a.digit+"})?$","g"),reg_email=/\w+@[0-9a-z\-]+(\.[a-z]{2,6}){1,2}/g;for(var f=0;f<a.type.length;f++){var g=a.type[f];switch(g){case"int":if(""!=a.value&&!b.test(a.value.replace(/\,/g,"")))return{errorType:g,iNum:f};break;case"int100":if(""!=a.value&&!c.test(a.value))return{errorType:g,iNum:f};break;case"int30":if(""!=a.value&&!d.test(a.value))return{errorType:g,iNum:f};break;case"empty":if(""==a.value.replace(e,""))return{errorType:g,iNum:f};break;case"mobile":if(""!=a.value&&!reg_mobile.test(a.value))return{errorType:g,iNum:f};break;case"id":if(""!=a.value&&!reg_id.test(a.value))return{errorType:g,iNum:f};break;case"length":if(""!=a.value&&!(a.value.length>0&&a.value.length<=a.maxlen))return{errorType:g,iNum:f};break;case"selCompare":if(a.value==a.compareVal)return{errorType:g,iNum:f};break;case"date":if(""!=a.value&&!reg_date.test(a.value))return{errorType:g,iNum:f};break;case"firstPhone":if(""!=a.value&&!reg_first_phone.test(a.value))return{errorType:g,iNum:f};break;case"secondPhone":if(""!=a.value&&!reg_second_phone.test(a.value))return{errorType:g,iNum:f};break;case"thirdPhone":if(""!=a.value&&!reg_third_phone.test(a.value))return{errorType:g,iNum:f};break;case"decimal":if(""!=a.value&&!reg_decimal.test(a.value))return{errorType:g,iNum:f};case"email":if(""!=a.value&&!reg_email.test(a.value))return{errorType:g,iNum:f}}}return""}var f=window.location.pathname.toLowerCase();if(-1==f.indexOf("/invest/9")&&-1==f.indexOf("/myaccount/fund/overview")&&-1==f.indexOf("/fb/fund/detail"))return!1;if(-1!=f.indexOf("/invest/9")){var g=function(a,b,c){return 0!==b&&(b=2|b),"number"!=typeof parseInt(a)||c||(a=(a/100).toFixed(b)),a=(""+a).replace(/(\d)(?=(?:\d{3})+(?:\.\d+)?$)/g,"$1,")},h=function(a){$.ajax({url:"/export/invest/userData",type:"Get",dataType:"json",data:{t:Math.random()}}).done(function(a){0==a.errorCode&&($(".version-red-envelope").show(),$("strong[data-class='v-pp-balance']").html(g(a.data.currentBalance,2)),$("strong[data-class='v-pp-coupon']").html(g(a.data.couponAmount,2)))})};h()}var i=$(".main-offsetHeight"),j=$(".version1-mask"),k=$(".version-popup-main.popup-huoji"),l=$(".version-popup.popup-huoji"),m=$(".version-popup-main.popup-huoji-succ"),n=$(".version-popup.popup-huoji-succ"),o=$(".version-popup-main.popup-huoji-fail"),p=$(".version-popup.popup-huoji-fail"),q=$("[data-type='popup-redirect']"),r=$(".version-open-syd"),s={showFundPopup:function(){k.show();var a=$(window).width(),b=$(window).height(),c=$(document).width(),e=$(document).height(),f=(a-l.width())/2,g=(b-l.height())/2;j.show().css("width",c+"px").css("height",e+"px"),l.show().css("top",g+$(window).scrollTop()+"px").css("left",f+"px"),i.addClass("back-blur"),d()},hideFundPopup:function(){k.hide(),j.hide(),l.hide(),i.removeClass("back-blur"),d()},showKaihu:function(){q.hide(),r.show(),d()},hideKaihu:function(){q.show(),r.hide(),d()},showSucc:function(){m.show();var a=$(window).width(),b=$(window).height(),c=$(document).width(),e=$(document).height(),f=(a-n.width())/2,g=(b-n.height())/2;j.show().css("width",c+"px").css("height",e+"px"),n.show().css("top",g+$(window).scrollTop()+"px").css("left",f+"px"),i.addClass("back-blur"),d()},hideSucc:function(){m.hide(),j.hide(),n.hide(),i.removeClass("back-blur")},showFail:function(a){o.show();var b=$(window).width(),c=$(window).height(),e=$(document).width(),f=$(document).height(),g=(b-p.width())/2,h=(c-p.height())/2;j.show().css("width",e+"px").css("height",f+"px"),p.show().css("top",h+$(window).scrollTop()+"px").css("left",g+"px"),i.addClass("back-blur"),a&&p.find(".version-open-statecopy").html(a),d()},hideFail:function(){o.hide(),j.hide(),p.hide(),i.removeClass("back-blur")}};$(".version-popup-closed[data-type='huoji-close']").unbind("click").on("click",function(){return l.is(":hidden")||s.hideFundPopup(),n.is(":hidden")||s.hideSucc(),p.is(":hidden")||s.hideFail(),!1}),$("input[data-type='fund-account']").on("click",function(a){var b=$(this);void 0===$.cookie("syd_name")&&(window.location.href="https://passport.souyidai.com/?backurl="+document.URL),b.addClass("disabled").attr("disabled",!0),$.ajax({url:"/invest/fund/getUserInfo",type:"POST",dataType:"json",data:{t:Math.random()}}).done(function(a){if(0==a.errorCode){s.showFundPopup(),$("span[data-type='popup-name']").html(a.data.realName),$("span[data-type='popup-id5']").html(a.data.id5);for(var b=a.data.bankcardList,c=!1,d=0;d<b.length;d++)for(var e=0;e<t.banks.length;e++)if(b[d].bankCode==t.banks[e].ID){var f=x.find("a[data-value="+b[d].bankCode+"]");0==c&&0!=f.attr("data-openway")&&(y.html(b[d].bank),z.attr("data-value",b[d].bankCode),$("#popup_id").val(b[d].cardId).closest(".version-open-item").addClass("version-open-visitor"),c=!0),f.attr("data-cardId",b[d].cardId)}}else 1==a.errorCode&&("noLogin"==a.errorMessage?window.location.href="https://passport.souyidai.com/?backurl="+document.URL:s.showFail("您需要先进行实名认证，才可以开通基金账户，现在就去<a href='/myaccount/safecenter' target='_blank'>实名认证</a>"))}).fail(function(){}).always(function(){b.removeClass("disabled").attr("disabled",!1)})}),$("input[data-type='fund-buy']").on("click",function(){var a=$(this),b=null;b=$("input[data-type='fund-input-invest']");var c=1*b.val();return isNaN(c)||100>c?void b.focus():(a.addClass("disabled").attr("disabled",!0),void $.ajax({url:"/fb/doSubFund",type:"POST",dataType:"json",data:{amount:b.val()}}).done(function(a){if(0==a.errorCode){var b=a.data?"预计从"+a.data+"开始计算收益。":$("span[data-type='profit-date-tips']").html();alert("购买成功："+b),window.location.reload()}else"noLogin"==a.errorMessage?window.location.href="https://passport.souyidai.com/?backurl="+document.URL:alert(a.errorMessage)}).always(function(){a.removeClass("disabled").attr("disabled",!1)}))}),l.on("focus","input[type=text]",function(){var a=$(this),b=a.closest(".version-open-item"),c=a.attr("data-text"),d=a.val();b.addClass("version-open-focus").removeClass("version-open-border-false version-open-visitor"),d==c&&a.val("")}).on("blur","input[type=text]",function(){if("undefined"!=$(this).attr("data-error")){var a=$(this),b=a.attr("data-type").split(/\,/g),c=a.attr("digit")||"",d=a.attr("data-text"),f=a.val(),g=a.attr("data-length"),h=(a.attr("data-name"),a.closest(".version-open-item"));a.val($.trim(f)),f=a.val(),""==f||f==d?(f="",a.val(d),h.removeClass("version-open-focus").addClass("version-open-border-false")):h.removeClass("version-open-focus").addClass("version-open-visitor");var i={value:f,type:b,digit:c,maxlen:g},j=e(i);""!=j&&"object"==typeof j&&h.removeClass("version-open-focus").addClass("version-open-border-false")}});for(var t=$.parseJSON('{ "banks" : '+codes.fundBanks.hjbank.replace(/\'/g,'"')+"}"),u="",v=0;v<t.banks.length;v++){var w=t.banks[v];u+="0"==w.status?"<span ":'<a href="javascript:;" ',u+='data-value="'+w.ID+'" data-href="'+w.href+'" data-openway="'+w.openWay+'">'+w.name,u+="0"==w.status?"</span>":"</a>"}$(".version-bank-list").html("").html(u);var x=$(".version-bank-list"),y=$(".version-open-recive"),z=y.closest(".version-open-item"),A=!1;$(document).on("click",function(a){l.not(":hidden").length&&(z.removeClass("version-bank-select"),A&&""==z.attr("data-value")&&(A=!1,z.addClass("version-open-border-false")))}),z.on("click",function(){var a=$(this);return A=!0,a.removeClass("version-open-border-false").toggleClass("version-bank-select"),!1}),x.on("click","a[data-openway='1']",function(){s.showKaihu(),a.call(this);var b=$(this).attr("data-cardId");return b?($("#popup_id").val(b).closest(".version-open-item").removeClass("version-open-border-false"),z.removeClass("version-open-border-false")):($("#popup_id").val($("#popup_id").attr("data-text")),z.removeClass("version-bank-select")),!1}),x.on("click","a[data-openway='0']",function(){$(this);s.hideKaihu();var b=$(this).attr("data-cardId");return b?($("#popup_id").val(b).closest(".version-open-item").removeClass("version-open-border-false"),z.removeClass("version-open-border-false")):($("#popup_id").val($("#popup_id").attr("data-text")),z.removeClass("version-bank-select")),a.call(this),!1}),$("#popup-bankHref").on("click",function(){$(this);return c()?void $.ajax({url:"/invest/fund/getFundActive",type:"POST",dataType:"json",data:b()}).done(function(a){if(0==a.errorCode){var b=$("#form-huoji"),c=$.parseJSON(a.data.resultStr);b.attr("action",c.postUrl),b.find("input[name='sign']").val(c.sign),b.find("input[name='reqdata']").val(c.reqdata),b.find("input[name='channelcode']").val(c.channelcode),b.submit()}}):!1});var B=null;$(".version-btn-code[data-type='validate-code']").on("click",function(){var a=$(this);if(!a.hasClass("isTiming")){if($("input[type=text][id!='popup-sms']").trigger("blur"),A=!0,$(document).trigger("click"),$("#popup-sms").closest(".version-open-item").removeClass("version-open-border-false"),$(".version-popup[data-type='version-popup-mobel']").find(".version-open-item").hasClass("version-open-border-false"))return!1;var c=60;a.val("重新获取("+c--+")").addClass("isTiming").css("color","#999"),B=setInterval(function(){return 0==c?(clearInterval(B),void a.val("重新获取").removeClass("isTiming").css("color","#333")):void a.val("重新获取("+c--+")")},1e3),$.ajax({url:"/invest/fund/sendFundSms",type:"POST",dataType:"json",data:b()}).done(function(a){0!=a.errorCode&&("noLogin"!=a.errorMessage?alert(a.errorMessage):window.location.href="https://passport.souyidai.com/?backurl="+document.URL)})}});var C=$("em[data-type='popup-check']");C.on("click",function(){var a=$(this);return a.hasClass("checked")?a.removeClass("checked"):a.addClass("checked"),!1}),$(".version-open-btn[data-type='popup-submit'] a").on("click",function(){if(c()){var a=b();a.smscode=$("#popup-sms").val(),$.ajax({url:"/invest/fund/openAccount",type:"POST",dataType:"json",data:a}).done(function(a){0==a.errorCode?(setTimeout(function(){window.location.reload()},3e3),s.hideFundPopup(),s.showSucc()):"noLogin"!=a.errorMessage?(s.hideFundPopup(),s.showFail(a.errorMessage)):window.location.href="https://passport.souyidai.com/?backurl="+document.URL})}})}();